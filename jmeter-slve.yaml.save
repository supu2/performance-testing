apiVersion: apps/v1
kind: Deployment
metadata:
  name: jmeter-slave
  labels:
    app: jmeter-slave
spec:
  replicas: 2 # Number of JMeter slaves
  selector:
    matchLabels:
      app: jmeter-slave
  template:
    metadata:
      labels:
        app: jmeter-slave
    spec:
      containers:
        - name: jmeter-slave
          image: vybhavkadam1/jmeter:5.6.2
          imagePullPolicy: Always
          env:
            - name: HEAP
              value: "-Xms1g -Xmx1g"
           volumeMounts:
            - name: test-plan
              mountPath: /test
            - name: csv-files
              mountPath: /csv  # Mounting CSV files from PVC
          ports:
            - containerPort: 1099 # JMeter RMI port
            - containerPort: 60000 # JMeter slave communication
          args: ["-s", "-Dserver.rmi.ssl.disable=true"]
          volumes:
        - name: test-plan
          configMap:
            name: jmeter-config
        - name: csv-files
          persistentVolumeClaim:
            claimName: csv-files-pvc

